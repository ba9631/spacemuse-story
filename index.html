<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Muse</title>
    <!-- Tailwind CSS CDN for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js CDN for 3D graphics -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Font Awesome for various icons across the site -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Import Google Font 'Inter' for modern typography */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a; /* Deep space background */
            color: #e0e0e0; /* Light gray text for contrast */
            overflow-x: hidden; /* Prevent horizontal scroll on small screens */
        }
        /* Custom scrollbar for a sleek look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6a6a6a;
        }
        /* Canvas elements will dynamically size to their containers */
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        /* Section containers hidden by default, shown by JavaScript */
        .section-container {
            min-height: calc(100vh - 80px); /* Adjust based on header/footer height */
            padding: 2rem;
            display: none;
        }
        .active-section {
            display: block; /* Active section will be displayed */
        }
        /* Gradient for attractive buttons and elements */
        .btn-gradient {
            background: linear-gradient(135deg, #6b46c1, #805ad5);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover {
            background: linear-gradient(135deg, #805ad5, #6b46c1);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(128, 90, 213, 0.4);
        }
        /* Glassmorphism effect for cards and main content areas */
        .glassmorphism {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        /* Responsive utility classes for smaller text on mobile */
        @media (max-width: 768px) {
            .text-xl-mobile { font-size: 1.25rem; }
            .text-lg-mobile { font-size: 1.125rem; }
            .text-base-mobile { font-size: 1rem; }
            .text-sm-mobile { font-size: 0.875rem; }
        }
    </style>
</head>
<body>
    <!-- Header/Navigation Bar -->
    <nav class="bg-gray-900 bg-opacity-80 p-4 sticky top-0 z-50 shadow-lg rounded-b-lg">
        <div class="container mx-auto flex flex-wrap justify-between items-center">
            <!-- Brand Title with gradient text -->
            <a href="#" class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 rounded-lg p-2">Space Muse</a>
            <!-- Mobile Menu Button -->
            <div class="block lg:hidden">
                <button id="menu-btn" class="text-purple-300 focus:outline-none">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
            <!-- Navigation Links (hidden on mobile by default, shown by JS) -->
            <div id="nav-links" class="hidden lg:flex flex-grow justify-end items-center space-x-4 mt-4 lg:mt-0 w-full lg:w-auto">
                <button class="nav-link text-purple-300 hover:text-white px-3 py-2 rounded-md transition duration-300 btn-gradient" data-section="home">Home</button>
                <button class="nav-link text-purple-300 hover:text-white px-3 py-2 rounded-md transition duration-300 btn-gradient" data-section="solar-system">Solar System</button>
                <button class="nav-link text-purple-300 hover:text-white px-3 py-2 rounded-md transition duration-300 btn-gradient" data-section="constellations">Constellations</button>
                <button class="nav-link text-purple-300 hover:text-white px-3 py-2 rounded-md transition duration-300 btn-gradient" data-section="stories">Space Stories</button>
                <button class="nav-link text-purple-300 hover:text-white px-3 py-2 rounded-md transition duration-300 btn-gradient" data-section="chatbot">AI Chatbot</button>
                <button class="nav-link text-purple-300 hover:text-white px-3 py-2 rounded-md transition duration-300 btn-gradient" data-section="quiz">Space Quiz</button>
                <button class="nav-link text-purple-300 hover:text-white px-3 py-2 rounded-md transition duration-300 btn-gradient" data-section="calendar">Cosmic Calendar</button>
                <button class="nav-link text-purple-300 hover:text-white px-3 py-2 rounded-md transition duration-300 btn-gradient" data-section="timeline">Space Timeline</button>
                <button class="nav-link text-purple-300 hover:text-white px-3 py-2 rounded-md transition duration-300 btn-gradient" data-section="visuals">Interactive Visuals</button>
                <button class="nav-link text-purple-300 hover:text-white px-3 py-2 rounded-md transition duration-300 btn-gradient" data-section="games">Mini Games</button>
                <button class="nav-link text-purple-300 hover:text-white px-3 py-2 rounded-md transition duration-300 btn-gradient" data-section="glossary">Glossary</button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area - All sections are contained here -->
    <main class="container mx-auto mt-8 p-4">
        <!-- Home Section: The welcoming page -->
        <section id="home-section" class="section-container active-section flex flex-col items-center justify-center text-center min-h-screen">
            <h1 class="text-5xl lg:text-7xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-500 to-pink-600 animate-pulse-slow">Welcome to Space Muse</h1>
            <p class="text-xl lg:text-3xl text-gray-300 mt-4 max-w-3xl leading-relaxed">Your portal to the cosmos. Explore, learn, and be inspired by the wonders of space.</p>
            <div class="flex flex-wrap justify-center gap-4 mt-8">
                <button class="btn-gradient text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:scale-105 transform transition duration-300 nav-link" data-section="solar-system">Explore Solar System <i class="fas fa-planet ml-2"></i></button>
                <button class="btn-gradient text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:scale-105 transform transition duration-300 nav-link" data-section="stories">Read Space Stories <i class="fas fa-book-open ml-2"></i></button>
                <button class="btn-gradient text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:scale-105 transform transition duration-300 nav-link" data-section="chatbot">Chat with AI <i class="fas fa-robot ml-2"></i></button>
            </div>
            <div class="mt-12 text-gray-400">
                <p>"The cosmos is within us. We are made of star-stuff. We are a way for the universe to know itself." - Carl Sagan</p>
            </div>
        </section>

        <!-- Solar System Section: Interactive 3D model -->
        <section id="solar-system-section" class="section-container">
            <h2 class="text-4xl font-bold text-purple-400 mb-6 text-center">Interactive 3D Solar System</h2>
            <div id="solar-system-container" class="relative w-full h-[600px] rounded-lg overflow-hidden glassmorphism">
                <canvas id="solar-system-canvas" class="w-full h-full"></canvas>
                <div class="absolute top-4 right-4 bg-gray-800 bg-opacity-70 p-3 rounded-lg text-sm text-gray-200">
                    Drag to rotate, Scroll to zoom
                </div>
                <div class="absolute bottom-4 left-4 right-4 flex flex-col items-center">
                    <label for="time-warp-slider" class="text-gray-300 mb-2">Time Warp Speed: <span id="time-warp-value">1x</span></label>
                    <input type="range" id="time-warp-slider" min="0.05" max="2" value="1" step="0.05" class="w-2/3 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>
        </section>

        <!-- Constellations Section: Image viewer with mythology -->
        <section id="constellations-section" class="section-container">
            <h2 class="text-4xl font-bold text-pink-400 mb-6 text-center">Interactive 3D Constellations</h2>
            <div id="constellations-3d-container" class="relative w-full h-[600px] rounded-lg overflow-hidden glassmorphism">
                <canvas id="constellations-canvas" class="w-full h-full"></canvas>
                <div class="absolute top-4 right-4 bg-gray-800 bg-opacity-70 p-3 rounded-lg text-sm text-gray-200">
                    Drag to rotate, Scroll to zoom
                </div>
            </div>
            <p class="text-center text-gray-400 mt-8">Click on stars for more information!</p>
        </section>

        <!-- Space Stories Section: Poetic narratives -->
        <section id="stories-section" class="section-container">
            <h2 class="text-4xl font-bold text-blue-400 mb-6 text-center">Cosmic Narratives & Space Poetry</h2>
            <div class="space-y-8">
                <div class="glassmorphism p-6 rounded-lg">
                    <h3 class="text-2xl font-semibold text-white mb-3">The Whisper of Nebulas</h3>
                    <img src="https://placehold.co/600x300/2c3e50/ffffff?text=Nebula+Art" alt="Nebula Art" class="w-full h-auto rounded-lg mb-4 shadow-md">
                    <p class="text-gray-300 text-base-mobile">
                        In the vast tapestry of the cosmos, where stardust is spun into dreams, there exists a place where nebulae whisper ancient tales. Their vibrant hues, a palette of cosmic creation, paint canvases millions of light-years wide. Each swirling cloud, a birthplace of stars, hums with the promise of new worlds, new beginnings. Listen closely, and you might hear the gentle sigh of collapsing gas, the joyous burst of a star igniting, a symphony of genesis echoing through the void.
                    </p>
                </div>
                <div class="glassmorphism p-6 rounded-lg">
                    <h3 class="text-2xl font-semibold text-white mb-3">The Solitude of Mars</h3>
                    <img src="https://placehold.co/600x300/8e44ad/ffffff?text=Mars+Landscape" alt="Mars Landscape" class="w-full h-auto rounded-lg mb-4 shadow-md">
                    <p class="text-gray-300 text-base-mobile">
                        Mars, the Red Planet, stands as a silent sentinel in our celestial neighborhood. Its rust-colored deserts stretch endlessly under a sky often tinged with an eerie blue. Canyons deeper than any on Earth carve through its surface, telling stories of ancient floods, of a past vastly different from its present solitude. Humanity gazes upon it with longing, a future home, a cosmic frontier. Soon, perhaps, the silence will be broken by the footsteps of explorers, transforming its quietude into a testament of courage and discovery.
                    </p>
                </div>
            </div>
        </section>

        <!-- AI Chatbot Section -->
        <section id="chatbot-section" class="section-container">
            <h2 class="text-4xl font-bold text-green-400 mb-6 text-center">Space AI Assistant</h2>
            <div class="flex flex-col h-[70vh] glassmorphism rounded-lg p-6">
                <div id="chat-output" class="flex-grow overflow-y-auto p-4 bg-gray-800 rounded-lg mb-4 space-y-4">
                    <!-- Chat messages will be dynamically added here -->
                    <div class="flex justify-start">
                        <div class="bg-blue-600 text-white p-3 rounded-lg max-w-xs md:max-w-md">
                            Hello! I am your Space Muse AI. Ask me anything about the cosmos!
                        </div>
                    </div>
                </div>
                <div class="flex">
                    <input type="text" id="chat-input" placeholder="Ask me about space..." class="flex-grow p-3 rounded-l-lg bg-gray-700 text-white border border-gray-600 focus:ring-2 focus:ring-purple-500 outline-none">
                    <button id="send-chat-btn" class="btn-gradient text-white p-3 rounded-r-lg font-semibold flex items-center">
                        <i class="fas fa-paper-plane mr-2"></i> Send
                    </button>
                </div>
                <div id="chat-loading" class="text-center text-gray-400 mt-2 hidden">
                    <i class="fas fa-spinner fa-spin mr-2"></i> Thinking...
                </div>
            </div>
        </section>

        <!-- Quiz Section: Space facts challenge -->
        <section id="quiz-section" class="section-container">
            <h2 class="text-4xl font-bold text-yellow-400 mb-6 text-center">Cosmic Quiz Challenge</h2>
            <div class="glassmorphism p-6 rounded-lg max-w-2xl mx-auto">
                <div id="quiz-intro">
                    <p class="text-lg text-gray-300 mb-4 text-center">Test your knowledge of the universe!</p>
                    <div class="flex justify-center gap-4">
                        <button id="start-easy-quiz" class="btn-gradient text-white py-2 px-5 rounded-full" data-difficulty="easy">Easy</button>
                        <button id="start-medium-quiz" class="btn-gradient text-white py-2 px-5 rounded-full" data-difficulty="medium">Medium</button>
                        <button id="start-hard-quiz" class="btn-gradient text-white py-2 px-5 rounded-full" data-difficulty="hard">Hard</button>
                    </div>
                </div>
                <div id="quiz-questions" class="hidden">
                    <h3 id="quiz-difficulty" class="text-xl font-semibold text-center mb-4"></h3>
                    <p id="question-text" class="text-lg text-white mb-4"></p>
                    <div id="answer-options" class="flex flex-col space-y-3">
                        <!-- Options will be dynamically loaded here -->
                    </div>
                    <button id="next-question-btn" class="btn-gradient text-white mt-6 py-2 px-5 rounded-full w-full">Next Question</button>
                </div>
                <div id="quiz-result" class="hidden text-center">
                    <h3 class="text-3xl font-bold text-purple-300 mb-4">Quiz Complete!</h3>
                    <p id="score-text" class="text-2xl text-white mb-6"></p>
                    <button id="reset-quiz-btn" class="btn-gradient text-white py-2 px-5 rounded-full">Play Again</button>
                </div>
            </div>
        </section>

        <!-- Cosmic Calendar Section: Events & Pop-ups -->
        <section id="calendar-section" class="section-container">
            <h2 class="text-4xl font-bold text-orange-400 mb-6 text-center">Cosmic Events Calendar</h2>
            <div class="glassmorphism p-6 rounded-lg mx-auto max-w-4xl">
                <div id="calendar-controls" class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                    <div id="calendar-header" class="flex justify-between items-center">
                        <button id="prev-year" class="btn-gradient text-white p-2 rounded-full"><i class="fas fa-backward"></i></button>
                        <button id="prev-month" class="btn-gradient text-white p-2 rounded-full mx-2"><i class="fas fa-chevron-left"></i></button>
                        <h3 id="current-month-year" class="text-2xl font-semibold text-white px-4 text-center"></h3>
                        <button id="next-month" class="btn-gradient text-white p-2 rounded-full mx-2"><i class="fas fa-chevron-right"></i></button>
                        <button id="next-year" class="btn-gradient text-white p-2 rounded-full"><i class="fas fa-forward"></i></button>
                    </div>
                    <div class="flex items-center gap-2">
                        <label for="event-filter" class="text-gray-300">Filter by type:</label>
                        <select id="event-filter" class="bg-gray-700 text-white p-2 rounded-lg border border-gray-600 focus:ring-2 focus:ring-purple-500 outline-none">
                            <option value="">All Events</option>
                            <!-- Options will be populated by JS -->
                        </select>
                    </div>
                </div>
                <div id="calendar-loading" class="text-center text-gray-400 my-4 hidden">
                    <i class="fas fa-spinner fa-spin mr-2"></i> Fetching events from NASA...
                </div>
                <div class="grid grid-cols-7 gap-2 text-center text-gray-400 font-semibold mb-2">
                    <span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 gap-2">
                    <!-- Calendar days will be rendered here -->
                </div>
            </div>
        </section>

        <!-- Historical Space Timeline -->
        <section id="timeline-section" class="section-container">
            <h2 class="text-4xl font-bold text-cyan-400 mb-6 text-center">Historical Space Timeline</h2>
            <div class="glassmorphism p-8 rounded-lg max-w-4xl mx-auto">
                <div id="timeline-container" class="relative">
                    <!-- Vertical line for the timeline -->
                    <div class="absolute left-1/2 transform -translate-x-1/2 w-1 h-full bg-purple-500 rounded-full"></div>
                    <!-- Timeline events (alternating left/right) -->
                    <div class="timeline-event flex items-center mb-8 relative">
                        <div class="w-1/2 pr-8 text-right">
                            <h3 class="text-xl font-semibold text-white">1957: Sputnik 1</h3>
                            <p class="text-gray-300 text-sm-mobile">The Soviet Union launched the first artificial Earth satellite, marking the beginning of the Space Age.</p>
                        </div>
                        <div class="absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-purple-500 rounded-full border-2 border-white z-10"></div>
                        <div class="w-1/2 pl-8"></div>
                    </div>
                    <div class="timeline-event flex items-center mb-8 relative flex-row-reverse">
                        <div class="1/2 pl-8 text-left">
                            <h3 class="text-xl font-semibold text-white">1961: Yuri Gagarin</h3>
                            <p class="text-gray-300 text-sm-mobile">First human in space, orbiting Earth aboard Vostok 1.</p>
                        </div>
                        <div class="absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-purple-500 rounded-full border-2 border-white z-10"></div>
                        <div class="w-1/2 pr-8"></div>
                    </div>
                    <div class="timeline-event flex items-center mb-8 relative">
                        <div class="w-1/2 pr-8 text-right">
                            <h3 class="text-xl font-semibold text-white">1969: Apollo 11 Moon Landing</h3>
                            <p class="text-gray-300 text-sm-mobile">Neil Armstrong and Buzz Aldrin become the first humans to walk on the Moon.</p>
                        </div>
                        <div class="absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-purple-500 rounded-full border-2 border-white z-10"></div>
                        <div class="w-1/2 pl-8"></div>
                    </div>
                    <div class="timeline-event flex items-center mb-8 relative flex-row-reverse">
                        <div class="w-1/2 pl-8 text-left">
                            <h3 class="text-xl font-semibold text-white">2000: ISS First Crew</h3>
                            <p class="text-gray-300 text-sm-mobile">The International Space Station receives its first resident crew, beginning continuous human presence in space.</p>
                        </div>
                        <div class="absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-purple-500 rounded-full border-2 border-white z-10"></div>
                        <div class="w-1/2 pr-8"></div>
                    </div>
                     <div class="timeline-event flex items-center mb-8 relative">
                        <div class="w-1/2 pr-8 text-right">
                            <h3 class="text-xl font-semibold text-white">2020: SpaceX Crew Dragon</h3>
                            <p class="text-300 text-sm-mobile">SpaceX becomes the first private company to launch astronauts to the ISS.</p>
                        </div>
                        <div class="absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-purple-500 rounded-full border-2 border-white z-10"></div>
                        <div class="w-1/2 pl-8"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Interactive Visuals Section: Simulations -->
        <section id="visuals-section" class="section-container">
            <h2 class="text-4xl font-bold text-rose-400 mb-6 text-center">Interactive Cosmic Visuals</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Moon Phases Simulation -->
                <div class="glassmorphism p-6 rounded-lg flex flex-col items-center text-center">
                    <h3 class="text-2xl font-semibold text-white mb-4">Moon Phases Simulator</h3>
                    <canvas id="moon-phases-canvas" width="300" height="300" class="rounded-full border border-gray-600 shadow-md"></canvas>
                    <div class="mt-4 w-full">
                        <input type="range" id="moon-phase-slider" min="0" max="360" value="0" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        <p id="moon-phase-text" class="text-gray-300 mt-2">New Moon</p>
                    </div>
                </div>

                <!-- Eclipse Simulation -->
                <div class="glassmorphism p-6 rounded-lg flex flex-col items-center text-center">
                    <h3 class="text-2xl font-semibold text-white mb-4">Eclipse Simulation</h3>
                    <canvas id="eclipse-canvas" width="400" height="300" class="rounded-lg border border-gray-600 shadow-md"></canvas>
                    <button id="start-eclipse-sim" class="btn-gradient text-white py-2 px-5 rounded-full mt-4">Start Simulation</button>
                    <p class="text-gray-400 text-sm-mobile mt-2">A simplified representation of a solar eclipse.</p>
                </div>

                <!-- Rocket Launch Simulation -->
                <div class="glassmorphism p-6 rounded-lg md:col-span-2 flex flex-col items-center text-center">
                    <h3 class="text-2xl font-semibold text-white mb-4">Rocket Launch & Orbit Simulation</h3>
                    <canvas id="rocket-launch-canvas" width="800" height="400" class="rounded-lg border border-gray-600 shadow-md"></canvas>
                    <button id="start-rocket-sim" class="btn-gradient text-white py-2 px-5 rounded-full mt-4">Launch Rocket</button>
                    <p class="text-gray-400 text-sm-mobile mt-2">Watch a simplified rocket launch into orbit.</p>
                </div>
            </div>
        </section>

        <!-- Mini Games Section -->
        <section id="games-section" class="section-container">
            <h2 class="text-4xl font-bold text-teal-400 mb-6 text-center">Cosmic Mini Games</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Gravity Slingshot Simulator -->
                <div class="glassmorphism p-6 rounded-lg flex flex-col items-center text-center">
                    <h3 class="text-2xl font-semibold text-white mb-4">Gravity Slingshot</h3>
                    <canvas id="slingshot-canvas" width="300" height="300" class="bg-gray-900 rounded-lg border border-gray-600"></canvas>
                    <button id="start-slingshot" class="btn-gradient text-white py-2 px-5 rounded-full mt-4">Launch Ship</button>
                    <p class="text-gray-400 text-sm-mobile mt-2">Utilize planetary gravity to boost your ship's speed!</p>
                </div>

                <!-- Meteor Dodge Game -->
                <div class="glassmorphism p-6 rounded-lg flex flex-col items-center text-center">
                    <h3 class="text-2xl font-semibold text-white mb-4">Meteor Dodge</h3>
                    <canvas id="meteor-dodge-canvas" width="300" height="300" class="bg-gray-900 rounded-lg border border-gray-600"></canvas>
                    <button id="start-meteor-dodge" class="btn-gradient text-white py-2 px-5 rounded-full mt-4">Start Game</button>
                    <p class="text-gray-400 text-sm-mobile mt-2">Navigate your ship through an asteroid field!</p>
                </div>

                <!-- Space Maze Game -->
                <div class="glassmorphism p-6 rounded-lg flex flex-col items-center text-center">
                    <h3 class="text-2xl font-semibold text-white mb-4">Space Maze</h3>
                    <canvas id="space-maze-canvas" width="300" height="300" class="bg-gray-900 rounded-lg border border-gray-600"></canvas>
                    <button id="start-space-maze" class="btn-gradient text-white py-2 px-5 rounded-full mt-4">Start Maze</button>
                    <p class="text-gray-400 text-sm-mobile mt-2">Find your way through the cosmic labyrinth.</p>
                </div>
            </div>
        </section>

        <!-- Glossary Section: Cosmic terms with search -->
        <section id="glossary-section" class="section-container">
            <h2 class="text-4xl font-bold text-indigo-400 mb-6 text-center">Glossary of Cosmic Terms</h2>
            <div class="glassmorphism p-6 rounded-lg max-w-3xl mx-auto">
                <input type="text" id="glossary-search" placeholder="Search terms..." class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:ring-2 focus:ring-purple-500 outline-none mb-4">
                <div id="glossary-list" class="space-y-4 max-h-96 overflow-y-auto">
                    <!-- Glossary terms (filterable by search) -->
                    <div class="glossary-item">
                        <h3 class="text-xl font-semibold text-white">Asteroid</h3>
                        <p class="text-gray-300 text-base-mobile">A small rocky body orbiting the Sun, much smaller than a planet. Asteroids are primarily found in the asteroid belt between Mars and Jupiter.</p>
                    </div>
                    <div class="glossary-item">
                        <h3 class="text-xl font-semibold text-white">Black Hole</h3>
                        <p class="text-gray-300 text-base-mobile">A region of spacetime where gravity is so strong that nothing—no particles or even electromagnetic radiation such as light—can escape from it.</p>
                    </div>
                    <div class="glossary-item">
                        <h3 class="text-xl font-semibold text-white">Galaxy</h3>
                        <p class="text-gray-300 text-base-mobile">A massive, gravitationally bound system consisting of stars, stellar remnants, an interstellar medium of gas and dust, and dark matter. The word galaxy is derived from the Greek galaxias, literally "milky", a reference to the Milky Way galaxy.</p>
                    </div>
                    <div class="glossary-item">
                        <h3 class="text-xl font-semibold text-white">Nebula</h3>
                        <p class="text-gray-300 text-base-mobile">An interstellar cloud of dust, hydrogen, helium and other ionized gases. It is the birthplace of stars.</p>
                    </div>
                    <div class="glossary-item">
                        <h3 class="text-xl font-semibold text-white">Supernova</h3>
                        <p class="text-gray-300 text-base-mobile">A powerful and luminous stellar explosion. It is the largest explosion that takes place in space.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Generic Modal Structure (for alerts, planet info, etc.) -->
        <div id="custom-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]">
            <div class="glassmorphism p-6 rounded-lg max-w-sm md:max-w-md w-full relative">
                <button id="modal-close-btn" class="absolute top-3 right-3 text-gray-400 hover:text-white text-xl"><i class="fas fa-times"></i></button>
                <h4 id="modal-title" class="text-xl font-bold text-purple-300 mb-3 text-center"></h4>
                <div id="modal-content" class="text-gray-200 mb-5 overflow-y-auto max-h-[70vh]"></div>
                <div id="modal-actions" class="flex justify-center gap-4 mt-4"></div>
            </div>
        </div>

        <!-- "Did You Know?" Pop-up (controlled by JavaScript) -->
        <div id="did-you-know-popup" class="hidden fixed bottom-4 right-4 bg-gray-900 bg-opacity-90 glassmorphism p-4 rounded-lg shadow-xl max-w-sm z-50">
            <button class="absolute top-2 right-2 text-gray-400 hover:text-white" onclick="document.getElementById('did-you-know-popup').classList.add('hidden')"><i class="fas fa-times"></i></button>
            <h4 class="text-lg font-bold text-purple-300 mb-2">Did You Know? <i class="fas fa-lightbulb ml-1"></i></h4>
            <p id="did-you-know-fact" class="text-gray-200"></p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 bg-opacity-80 p-4 mt-8 text-center text-gray-500 text-sm rounded-t-lg">
        <p>&copy; 2025 Space Muse. All rights reserved. Built with passion for the cosmos.</p>
    </footer>

    <script type="module">
        // Global variables for Firebase (if persistence were to be added) - provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof _firebase_config !== 'undefined' ? JSON.parse(_firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Helper function to dispose of Three.js objects to prevent memory leaks
        function disposeThreeJsObject(obj) {
            if (obj.geometry) {
                obj.geometry.dispose();
            }
            if (obj.material) {
                if (Array.isArray(obj.material)) {
                    obj.material.forEach(material => material.dispose());
                } else {
                    obj.material.dispose();
                }
            }
            if (obj.children) {
                obj.children.forEach(child => disposeThreeJsObject(child));
            }
        }

        // --- Generic Modal Logic ---
        const customModal = document.getElementById('custom-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalActions = document.getElementById('modal-actions');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        // Function to show a generic modal
        function showModal(title, contentHTML, actionsHTML = '', showCloseButton = true) {
            modalTitle.innerHTML = title;
            modalContent.innerHTML = contentHTML;
            modalActions.innerHTML = actionsHTML;
            if (showCloseButton) {
                modalCloseBtn.classList.remove('hidden');
            } else {
                modalCloseBtn.classList.add('hidden');
            }
            customModal.classList.remove('hidden');
        }

        // Function to hide the generic modal
        function hideModal() {
            customModal.classList.add('hidden');
            // Clear content for next use
            modalTitle.innerHTML = '';
            modalContent.innerHTML = '';
            modalActions.innerHTML = '';
        }

        // Event listener for the modal close button
        modalCloseBtn.addEventListener('click', hideModal);

        // --- Custom Alert Box (re-using the generic modal) ---
        function alertBox(title, message, onConfirm = null) {
            const actions = <button id="alert-ok-btn" class="btn-gradient text-white py-2 px-5 rounded-full">OK</button>;
            showModal(title, <p>${message}</p>, actions);

            document.getElementById('alert-ok-btn').addEventListener('click', () => {
                hideModal();
                if (onConfirm) onConfirm();
            }, { once: true }); // Use once: true to ensure the event listener is removed after first click
        }
        
        // Function to display planet information using the generic modal
        function showPlanetInfo(planet) {
            const content = `
                <p class="text-gray-300 mb-2"><strong>Radius:</strong> ${planet.radius} units</p>
                <p class="text-gray-300 mb-2"><strong>Average Distance from Sun:</strong> ${planet.distance} units</p>
                <p class="text-gray-300 mb-4">${planet.description}</p>
            `;
            showModal(Information about ${planet.name}, content);
        }

        // Function to display star information
        function showStarInfo(star) {
            const content = `
                <p class="text-gray-300 mb-2"><strong>Constellation:</strong> ${star.constellationName}</p>
                <p class="text-gray-300 mb-4">${star.info}</p>
                <p class="text-gray-400 text-sm italic">${star.constellationDesc}</p>
            `;
            showModal(Star: ${star.id.charAt(0).toUpperCase() + star.id.slice(1)}, content);
        }

        // --- Navigation Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.section-container');
            const menuBtn = document.getElementById('menu-btn');
            const navLinksContainer = document.getElementById('nav-links');

            // Function to stop all Three.js animations and dispose scenes
            function stopAllThreeJsScenes() {
                if (solarSystemAnimationId) {
                    cancelAnimationFrame(solarSystemAnimationId);
                    solarSystemAnimationId = null;
                }
                if (solarSystemScene) { // Check if solar system scene exists globally
                    disposeThreeJsObject(solarSystemScene);
                    solarSystemScene = null;
                    solarSystemRenderer = null;
                    solarSystemCamera = null;
                    solarSystemRaycaster = null;
                    solarSystemMouse = null;
                    solarSystemPlanets = [];
                }

                if (constellationsAnimationId) {
                    cancelAnimationFrame(constellationsAnimationId);
                    constellationsAnimationId = null;
                }
                if (constellationsScene) { // Check if constellations scene exists globally
                    disposeThreeJsObject(constellationsScene);
                    constellationsScene = null;
                    constellationsRenderer = null;
                    constellationsCamera = null;
                    constellationsRaycaster = null;
                    constellationsMouse = null;
                    constellationsStars = []; // Ensure stars array is cleared
                }
            }


            // Toggle mobile navigation menu
            menuBtn.addEventListener('click', () => {
                navLinksContainer.classList.toggle('hidden');
                navLinksContainer.classList.toggle('flex');
            });

            // Handle section switching when a navigation link is clicked
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetSectionId = link.dataset.section + '-section';

                    // Stop and dispose of all active Three.js scenes before switching
                    stopAllThreeJsScenes();

                    // Hide all sections
                    sections.forEach(section => {
                        section.classList.remove('active-section');
                        section.style.display = 'none';
                    });

                    // Show the target section
                    const targetSection = document.getElementById(targetSectionId);
                    if (targetSection) {
                        targetSection.classList.add('active-section');
                        targetSection.style.display = 'block';
                    }

                    // Hide mobile menu after selection on smaller screens
                    if (window.innerWidth < 1024) {
                         navLinksContainer.classList.add('hidden');
                         navLinksContainer.classList.remove('flex');
                    }

                    // Initialize specific section components if they are active
                    // This ensures Three.js scenes or canvas games are only rendered when visible
                    if (targetSectionId === 'solar-system-section') {
                        initSolarSystem();
                    } else if (targetSectionId === 'constellations-section') {
                        initConstellations();
                    } else if (targetSectionId === 'visuals-section') {
                        initMoonPhases();
                        initEclipse();
                        initRocketLaunch();
                    } else if (targetSectionId === 'games-section') {
                        initSlingshotGame();
                        initMeteorDodgeGame();
                        initSpaceMazeGame();
                    } else if (targetSectionId === 'calendar-section') {
                        initCalendar();
                    }
                });
            });

            // Set 'home' section as active by default on page load
            document.getElementById('home-section').classList.add('active-section');
            document.getElementById('home-section').style.display = 'flex';
        });

        // --- "Did You Know?" Pop-up Logic ---
        const didYouKnowFacts = [
            "A day on Venus is longer than its year.",
            "There are more stars in the universe than grains of sand on all the beaches on Earth.",
            "The largest known volcano in our solar system is on Mars, called Olympus Mons.",
            "Saturn's rings are made up of billions of pieces of ice and rock.",
            "The Sun is so massive that it accounts for 99.86% of the total mass of the solar system.",
            "Neutron stars are so dense that a teaspoon of their material would weigh about 6 billion tons.",
            "The sound of space is completely silent because there is no atmosphere to carry sound waves.",
            "There are more trees on Earth than stars in the Milky Way galaxy."
        ];

        // Function to display a random "Did You Know?" fact
        function showDidYouKnownFact() {
            const popup = document.getElementById('did-you-know-popup');
            const factText = document.getElementById('did-you-know-fact');
            // Corrected variable name from didYouKnownFacts to didYouKnowFacts
            const randomIndex = Math.floor(Math.random() * didYouKnowFacts.length);
            factText.textContent = didYouKnowFacts[randomIndex];
            popup.classList.remove('hidden'); // Show the pop-up
            setTimeout(() => {
                popup.classList.add('hidden'); // Hide after 15 seconds
            }, 15000);
        }

        // Show a fact immediately on page load and then every 60 seconds
        document.addEventListener('DOMContentLoaded', showDidYouKnownFact);
        setInterval(showDidYouKnownFact, 60000);

        // --- Three.js Solar System ---
        let solarSystemScene, solarSystemCamera, solarSystemRenderer, solarSystemRaycaster, solarSystemMouse; // Declare Three.js core components including raycaster and mouse
        let solarSystemSun;
        let solarSystemPlanets = []; // Array to hold planet Mesh objects
        let solarSystemAnimationId; // To control animation frame
        let solarSystemSpeedFactor = 1.0; // Adjustable speed factor for time warp

        // Data for planets: radius, color, distance from Sun, orbital speed, and detailed description
        const planetData = [
            { name: 'Mercury', radius: 0.8, color: 0x888888, distance: 20, orbitSpeed: 0.05, selfRotationSpeed: 0.01, description: "The smallest planet in our solar system, closest to the Sun. It has a heavily cratered surface and experiences extreme temperature variations. A day on Mercury is about 59 Earth days, and a year is only 88 Earth days." },
            { name: 'Venus', radius: 1.5, color: 0xffa500, distance: 30, orbitSpeed: 0.03, selfRotationSpeed: -0.005, description: "Often called Earth's 'sister planet' due to its similar size. It has a thick, toxic atmosphere of carbon dioxide and is the hottest planet. Interestingly, it rotates in the opposite direction to most planets, and its day is longer than its year." },
            { name: 'Earth', radius: 1.6, color: 0x0000ff, distance: 40, orbitSpeed: 0.02, selfRotationSpeed: 0.03, description: "Our home planet, the only known celestial body to harbor life. Known for its vast oceans, diverse ecosystems, and a single natural satellite, the Moon. Its year is 365.25 days." },
            { name: 'Mars', radius: 1.2, color: 0xff0000, distance: 50, orbitSpeed: 0.015, selfRotationSpeed: 0.025, description: "Known as the 'Red Planet' due to its iron oxide-rich surface. It has polar ice caps, volcanoes, and evidence of ancient river valleys, making it a prime candidate for future human exploration. It has two small moons, Phobos and Deimos." },
            { name: 'Jupiter', radius: 5, color: 0xcc9966, distance: 80, orbitSpeed: 0.01, selfRotationSpeed: 0.04, description: "The largest planet in our solar system, a gas giant with a distinctive Great Red Spot—a colossal storm larger than Earth. It has a powerful magnetic field and at least 79 known moons, including the four Galilean moons (Io, Europa, Ganymede, Callisto)." },
            { name: 'Saturn', radius: 4, color: 0xd2b48c, distance: 100, orbitSpeed: 0.008, selfRotationSpeed: 0.035, description: "Famous for its magnificent ring system, composed of countless ice particles and rocky debris. Saturn is another gas giant with a vast family of moons, the largest being Titan, which has a thick atmosphere." },
            { name: 'Uranus', radius: 3, color: 0xaaffff, distance: 120, orbitSpeed: 0.005, selfRotationSpeed: 0.02, description: "An ice giant that rotates on its side, giving it unique seasonal cycles. Its atmosphere contains methane, which gives it a blue-green color. It has faint rings and many moons." },
            { name: 'Neptune', radius: 2.8, color: 0x00008b, distance: 140, orbitSpeed: 0.003, selfRotationSpeed: 0.018, description: "The farthest known planet from the Sun, another ice giant with powerful winds and a deep blue appearance due to methane in its atmosphere. It has a notable moon, Triton, which orbits in a retrograde direction." }
        ];

        // Initialize the 3D Solar System scene
        function initSolarSystem() {
            // Cancel any previous animation to prevent multiple animation loops running
            if (solarSystemAnimationId) {
                cancelAnimationFrame(solarSystemAnimationId);
            }
            // Clear existing scene elements if re-initialization is needed
            if (solarSystemScene) {
                disposeThreeJsObject(solarSystemScene);
            }

            const container = document.getElementById('solar-system-container');
            const canvas = document.getElementById('solar-system-canvas');
            const timeWarpSlider = document.getElementById('time-warp-slider');
            const timeWarpValue = document.getElementById('time-warp-value');

            if (!container || !canvas || !timeWarpSlider || !timeWarpValue) {
                console.error("Solar system elements not found. Cannot initialize 3D.");
                return;
            }

            // Set canvas width and height for proper rendering resolution
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;

            // Scene setup
            solarSystemScene = new THREE.Scene();
            solarSystemCamera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            solarSystemRenderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
            solarSystemRenderer.setSize(canvas.clientWidth, canvas.clientHeight);
            solarSystemRenderer.setPixelRatio(window.devicePixelRatio);
            solarSystemRenderer.setClearColor(0x000000, 0); // Transparent background

            // Add a starry background using Points (particles)
            const starGeometry = new THREE.BufferGeometry();
            const starVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starVertices.push(x, y, z);
            }
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(new Float32Array(starVertices), 3));
            const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.5 });
            const stars = new THREE.Points(starGeometry, starMaterial);
            solarSystemScene.add(stars);

            // Sun: Central object and light source
            const sunGeometry = new THREE.SphereGeometry(10, 32, 32);
            // Increased emissive component for a more luminous Sun
            const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00, emissive: 0xffaa00, emissiveIntensity: 0.8 });
            solarSystemSun = new THREE.Mesh(sunGeometry, sunMaterial);
            solarSystemSun.userData = { // Add Sun information for pop-up
                name: 'Sun',
                radius: '695,000 km', // Approximate actual radius
                distance: '0 km', // Reference point
                description: "The Sun is the star at the center of our Solar System. It is a nearly perfect sphere of hot plasma, heated to incandescence by nuclear fusion reactions in its core. It provides the energy for almost all life on Earth."
            };
            solarSystemScene.add(solarSystemSun);

            // PointLight: Illuminates the scene from the Sun's position
            const pointLight = new THREE.PointLight(0xffffff, 2, 1000);
            pointLight.position.set(0, 0, 0);
            solarSystemScene.add(pointLight);

            // Clear previous planets array
            solarSystemPlanets = [];

            // Create each planet and its orbit
            planetData.forEach(data => {
                const planetGeometry = new THREE.SphereGeometry(data.radius, 32, 32);
                const planetMaterial = new THREE.MeshLambertMaterial({ color: data.color });
                const planet = new THREE.Mesh(planetGeometry, planetMaterial);
                planet.position.x = data.distance;
                planet.userData = { ...data }; // Store all data in userData for easy access
                solarSystemPlanets.push(planet);
                solarSystemScene.add(planet);

                // Add orbit line for the planet
                const orbitRadius = data.distance;
                const orbitGeometry = new THREE.TorusGeometry(orbitRadius, 0.05, 16, 100);
                const orbitMaterial = new THREE.MeshBasicMaterial({ color: 0x444444, side: THREE.DoubleSide });
                const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                orbit.rotation.x = Math.PI / 2;
                solarSystemScene.add(orbit);
            });

            solarSystemCamera.position.z = 200; // Initial camera position

            // Camera Controls: Mouse interaction for rotation and zoom
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            canvas.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            canvas.addEventListener('mouseup', () => {
                isDragging = false;
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const deltaX = e.clientX - previousMousePosition.x;
                const deltaY = e.clientY - previousMousePosition.y;

                const rotationSpeed = 0.005;
                solarSystemScene.rotation.y += deltaX * rotationSpeed;
                solarSystemScene.rotation.x += deltaY * rotationSpeed;
                solarSystemScene.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, solarSystemScene.rotation.x));
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                const zoomSpeed = 0.1;
                solarSystemCamera.position.z += e.deltaY * zoomSpeed;
                solarSystemCamera.position.z = Math.max(50, Math.min(500, solarSystemCamera.position.z));
            });

            // Initialize Raycaster for Sun and planet clicks
            solarSystemRaycaster = new THREE.Raycaster();
            solarSystemMouse = new THREE.Vector2();

            // Event listener for clicks on the canvas
            canvas.addEventListener('click', onSolarSystemCanvasClick);

            // Time Warp Slider Event Listener
            timeWarpSlider.addEventListener('input', (e) => {
                solarSystemSpeedFactor = parseFloat(e.target.value);
                timeWarpValue.textContent = ${solarSystemSpeedFactor.toFixed(2)}x; // Changed to 2 decimal places
            });
            timeWarpValue.textContent = ${solarSystemSpeedFactor.toFixed(2)}x; // Initialize display value


            // Animation Loop for Solar System
            function animateSolarSystem() {
                solarSystemAnimationId = requestAnimationFrame(animateSolarSystem);

                solarSystemSun.rotation.y += 0.002 * solarSystemSpeedFactor;

                solarSystemPlanets.forEach((planet) => {
                    const angle = Date.now() * planet.userData.orbitSpeed * solarSystemSpeedFactor;
                    planet.position.x = planet.userData.distance * Math.cos(angle);
                    planet.position.z = planet.userData.distance * Math.sin(angle);
                    planet.rotation.y += planet.userData.selfRotationSpeed * solarSystemSpeedFactor; // Add self-rotation
                });

                solarSystemRenderer.render(solarSystemScene, solarSystemCamera);
            }

            animateSolarSystem(); // Start the animation loop

            // Handle window resize for responsiveness
            window.addEventListener('resize', () => {
                const width = container.clientWidth;
                const height = container.clientHeight;
                solarSystemCamera.aspect = width / height;
                solarSystemCamera.updateProjectionMatrix();
                solarSystemRenderer.setSize(width, height);
                canvas.width = width;
                canvas.height = height;
            });
        }

        // Function to handle clicks on the Solar System canvas
        function onSolarSystemCanvasClick(event) {
            // Get the bounding rectangle of the canvas
            const canvasBounds = solarSystemRenderer.domElement.getBoundingClientRect();
            // Calculate mouse position relative to the canvas
            solarSystemMouse.x = ((event.clientX - canvasBounds.left) / canvasBounds.width) * 2 - 1;
            solarSystemMouse.y = - ((event.clientY - canvasBounds.top) / canvasBounds.height) * 2 + 1;

            // Update the raycaster with the camera and mouse position
            solarSystemRaycaster.setFromCamera(solarSystemMouse, solarSystemCamera);

            // Include both Sun and Planets for intersection detection
            const objectsToIntersect = [solarSystemSun, ...solarSystemPlanets];
            const intersects = solarSystemRaycaster.intersectObjects(objectsToIntersect);

            if (intersects.length > 0) {
                const clickedObject = intersects[0].object;
                // Ensure it's an object with defined userData (planet or sun)
                if (clickedObject.userData && clickedObject.userData.name) {
                    showPlanetInfo(clickedObject.userData);
                }
            }
        }

        // --- Three.js Constellations ---
        let constellationsScene, constellationsCamera, constellationsRenderer, constellationsRaycaster, constellationsMouse;
        let constellationsStars = []; // Store actual star Mesh objects
        let constellationsAnimationId;

        const constellationData = [
            {
                name: "Orion",
                description: "The Hunter, one of the most recognizable constellations. Famous for its belt and bright stars Betelgeuse and Rigel.",
                stars: [
                    { id: "betelgeuse", x: 20, y: 30, z: 0, info: "Betelgeuse: A red supergiant star, one of the largest and brightest stars in the night sky. It forms the shoulder of Orion." },
                    { id: "bellatrix", x: -20, y: 25, z: 0, info: "Bellatrix: A blue-white giant star, the other shoulder of Orion. It is the 27th brightest star in the night sky." },
                    { id: "alnilam", x: 0, y: 0, z: 0, info: "Alnilam: The central star in Orion's Belt. A large blue supergiant, one of the most luminous known stars." },
                    { id: "alnitak", x: -10, y: -5, z: 0, info: "Alnitak: The left-most star in Orion's Belt, a hot blue supergiant." },
                    { id: "mintaka", x: 10, y: 5, z: 0, info: "Mintaka: The right-most star in Orion's Belt, a multiple star system." },
                    { id: "saiph", x: -15, y: -30, z: 0, info: "Saiph: A blue supergiant, marking Orion's bottom right knee." },
                    { id: "rigel", x: 15, y: -35, z: 0, info: "Rigel: A blue supergiant, the brightest star in Orion and the seventh brightest star in the night sky. It marks Orion's left foot." }
                ],
                lines: [
                    ["betelgeuse", "alnilam"], ["bellatrix", "alnilam"],
                    ["alnilam", "alnitak"], ["alnilam", "mintaka"],
                    ["alnitak", "saiph"], ["mintaka", "rigel"],
                    ["betelgeuse", "bellatrix"], ["saiph", "rigel"] // Connecting outer boundaries
                ]
            },
            {
                name: "Ursa Major",
                description: "The Great Bear, famous for containing the Big Dipper asterism. A prominent constellation in the Northern Hemisphere.",
                stars: [
                    { id: "dubhe", x: -30, y: 20, z: 0, info: "Dubhe: The star at the top right of the Big Dipper's bowl, one of the two pointer stars that lead to Polaris." },
                    { id: "merak", x: -40, y: -10, z: 0, info: "Merak: The star at the bottom right of the Big Dipper's bowl, also a pointer star to Polaris." },
                    { id: "phecda", x: -10, y: -15, z: 0, info: "Phecda: The star at the bottom left of the Big Dipper's bowl." },
                    { id: "megrez", x: 0, y: 10, z: 0, info: "Megrez: The star connecting the Big Dipper's bowl to its handle, the faintest of the main seven stars." },
                    { id: "alioth", x: 20, y: 15, z: 0, info: "Alioth: The first star in the Big Dipper's handle, closest to the bowl. It is the brightest star in Ursa Major." },
                    { id: "mizar", x: 40, y: 10, z: 0, info: "Mizar: The middle star in the Big Dipper's handle, famous for its optical double Alcor, which is easily visible to the naked eye." },
                    { id: "alkaid", x: 50, y: -5, z: 0, info: "Alkaid: The star at the end of the Big Dipper's handle." }
                ],
                lines: [
                    ["dubhe", "merak"], ["merak", "phecda"], ["phecda", "megrez"], ["megrez", "dubhe"], // Bowl
                    ["megrez", "alioth"], ["alioth", "mizar"], ["mizar", "alkaid"] // Handle
                ]
            }
        ];

        function initConstellations() {
            if (constellationsAnimationId) {
                cancelAnimationFrame(constellationsAnimationId);
            }
            if (constellationsScene) {
                disposeThreeJsObject(constellationsScene);
            }

            const container = document.getElementById('constellations-3d-container');
            const canvas = document.getElementById('constellations-canvas');

            if (!container || !canvas) {
                console.error("Constellations elements not found. Cannot initialize 3D.");
                return;
            }

            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;

            constellationsScene = new THREE.Scene();
            constellationsCamera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            constellationsRenderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
            constellationsRenderer.setSize(canvas.clientWidth, canvas.clientHeight);
            constellationsRenderer.setPixelRatio(window.devicePixelRatio);
            constellationsRenderer.setClearColor(0x000000, 0); // Transparent background

            constellationsCamera.position.z = 100;

            const starMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff }); // White stars
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0x888888, linewidth: 2 }); // Gray lines

            constellationsStars = []; // Reset stars array

            constellationData.forEach((constellation, cIdx) => {
                const constellationGroup = new THREE.Group();
                // Offset each constellation group to prevent overlap
                constellationGroup.position.x = (cIdx % 2 === 0 ? -1 : 1) * 70; // Alternating X
                constellationGroup.position.y = (cIdx % 2 === 0 ? -1 : 1) * 30; // Alternating Y
                if (cIdx === 1) constellationGroup.position.x = 0; // For Ursa Major example

                const starMap = new Map(); // To easily link stars by ID for drawing lines

                // Create stars
                constellation.stars.forEach(starData => {
                    const starGeometry = new THREE.SphereGeometry(1.5, 16, 16); // Small sphere for stars
                    const star = new THREE.Mesh(starGeometry, starMaterial);
                    star.position.set(starData.x, starData.y, starData.z);
                    star.userData = { ...starData, constellationName: constellation.name, constellationDesc: constellation.description }; // Store star info
                    constellationGroup.add(star);
                    constellationsStars.push(star); // Add to global list for raycasting
                    starMap.set(starData.id, star.position);
                });

                // Create lines connecting stars
                constellation.lines.forEach(line => {
                    const startPos = starMap.get(line[0]);
                    const endPos = starMap.get(line[1]);

                    if (startPos && endPos) {
                        const points = [startPos, endPos];
                        const geometry = new THREE.BufferGeometry().setFromPoints(points);
                        const lineMesh = new THREE.Line(geometry, lineMaterial);
                        constellationGroup.add(lineMesh);
                    }
                });

                constellationsScene.add(constellationGroup);
            });

            // Camera Controls for Constellations
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            canvas.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            canvas.addEventListener('mouseup', () => {
                isDragging = false;
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const deltaX = e.clientX - previousMousePosition.x;
                const deltaY = e.clientY - previousMousePosition.y;

                const rotationSpeed = 0.005;
                constellationsScene.rotation.y += deltaX * rotationSpeed;
                constellationsScene.rotation.x += deltaY * rotationSpeed;
                constellationsScene.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, constellationsScene.rotation.x));
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                const zoomSpeed = 0.1;
                constellationsCamera.position.z += e.deltaY * zoomSpeed;
                constellationsCamera.position.z = Math.max(50, Math.min(500, constellationsCamera.position.z));
            });

            // Raycaster for star clicks
            constellationsRaycaster = new THREE.Raycaster();
            constellationsMouse = new THREE.Vector2();
            canvas.addEventListener('click', onConstellationsCanvasClick);


            function animateConstellations() {
                constellationsAnimationId = requestAnimationFrame(animateConstellations);
                constellationsRenderer.render(constellationsScene, constellationsCamera);
            }
            animateConstellations();

            window.addEventListener('resize', () => {
                const width = container.clientWidth;
                const height = container.clientHeight;
                constellationsCamera.aspect = width / height;
                constellationsCamera.updateProjectionMatrix();
                constellationsRenderer.setSize(width, height);
                canvas.width = width;
                canvas.height = height;
            });
        }

        // Function to handle clicks on the Constellations canvas
        function onConstellationsCanvasClick(event) {
            const canvasBounds = constellationsRenderer.domElement.getBoundingClientRect();
            constellationsMouse.x = ((event.clientX - canvasBounds.left) / canvasBounds.width) * 2 - 1;
            constellationsMouse.y = - ((event.clientY - canvasBounds.top) / canvasBounds.height) * 2 + 1;

            constellationsRaycaster.setFromCamera(constellationsMouse, constellationsCamera);

            const intersects = constellationsRaycaster.intersectObjects(constellationsStars);

            if (intersects.length > 0) {
                const clickedStar = intersects[0].object;
                if (clickedStar.userData && clickedStar.userData.info) {
                    showStarInfo(clickedStar.userData);
                }
